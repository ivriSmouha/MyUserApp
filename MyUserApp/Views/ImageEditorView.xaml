<!-- File: MyUserApp/Views/ImageEditorView.xaml -->
<UserControl x:Class="MyUserApp.Views.ImageEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MyUserApp.Views"
             xmlns:viewmodels="clr-namespace:MyUserApp.ViewModels"
             xmlns:converters="clr-namespace:MyUserApp.Converters"
             
            
             xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"

             d:DataContext="{d:DesignInstance Type=viewmodels:ImageEditorViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="768" d:DesignWidth="1280"
             Background="#FF2D2D30">

    <UserControl.Resources>
        <converters:SelectedToBorderBrushConverter x:Key="SelectedToBorderBrushConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <!-- Column 0: Image Thumbnails List -->
        <Border Grid.Column="0" Background="#FF3F3F46" BorderBrush="#FF4F4F56" BorderThickness="0,0,1,0">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="{Binding ProjectName}" Foreground="White" FontWeight="Bold" Margin="10" FontSize="16" TextWrapping="Wrap"/>
                <ListView ItemsSource="{Binding ImageThumbnails}" 
                          SelectedItem="{Binding SelectedImage, Mode=TwoWay}"
                          Background="Transparent" BorderThickness="0"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Width="160" Height="120" Margin="5" CornerRadius="4" BorderThickness="3">
                                <Border.BorderBrush>
                                    <MultiBinding Converter="{StaticResource SelectedToBorderBrushConverter}">
                                        <Binding Path="."/>
                                        <Binding Path="DataContext.SelectedImage" RelativeSource="{RelativeSource AncestorType=ListView}"/>
                                    </MultiBinding>
                                </Border.BorderBrush>
                                <Grid>
                                    <Image Source="{Binding}" Stretch="UniformToFill" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </DockPanel>
        </Border>

        <!-- Column 1: Switched to the more fundamental SKElement -->
        <Grid Grid.Column="1" Background="Black" ClipToBounds="True">
            <!-- 
              Using the more basic SKElement as suggested. It is less likely to
              fail in the Visual Studio designer, while providing the same drawing surface.
            -->
            <skia:SKElement x:Name="SkiaElement"
                            PaintSurface="CanvasView_PaintSurface"
                            MouseWheel="CanvasView_MouseWheel"
                            MouseLeftButtonDown="CanvasView_MouseLeftButtonDown"
                            MouseLeftButtonUp="CanvasView_MouseLeftButtonUp"
                            MouseMove="CanvasView_MouseMove"/>
        </Grid>

        <!-- Column 2: Control Panel for user actions -->
        <Border Grid.Column="2" Background="#FF3F3F46" BorderBrush="#FF4F4F56" BorderThickness="1,0,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10">
                    <TextBlock Text="View Controls" Foreground="White" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="Undo" Command="{Binding UndoCommand}" Margin="0,5,2,5"/>
                        <Button Grid.Column="1" Content="Redo" Command="{Binding RedoCommand}" Margin="2,5,0,5"/>
                    </Grid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="Rotate Left" Command="{Binding RotateLeftCommand}" Margin="0,5,2,5"/>
                        <Button Grid.Column="1" Content="Rotate Right" Command="{Binding RotateRightCommand}" Margin="2,5,0,5"/>
                    </Grid>

                    <Button Content="Reset View" Command="{Binding ResetViewCommand}" Margin="0,5"/>
                    <Button Content="Delete Selected" Command="{Binding DeleteAnnotationCommand}" Margin="0,5"/>
                    <Separator Margin="0,15"/>

                    <TextBlock Text="Annotation Filters" Foreground="White" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    <CheckBox IsChecked="{Binding ShowInspectorAnnotations}" Content="Inspector" Foreground="White"/>
                    <CheckBox IsChecked="{Binding ShowVerifierAnnotations}" Content="Verifier" Foreground="White"/>
                    <CheckBox IsChecked="{Binding ShowAiAnnotations}" Content="AI" Foreground="White"/>

                    <Separator Margin="0,15"/>
                    <TextBlock Text="Analysis" Foreground="White" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    <Button Content="Run AI Analysis" Command="{Binding RunAiAnalysisCommand}" Margin="0,5"/>

                    <Separator Margin="0,15"/>
                    <Button Content="Finish and Export Report" Command="{Binding FinishEditingCommand}" Background="#FF007ACC" Foreground="White" FontWeight="Bold" Padding="10" Margin="0,15,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>