<UserControl x:Class="MyUserApp.Views.AdminPanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewmodels="clr-namespace:MyUserApp.ViewModels" 
             xmlns:services="clr-namespace:MyUserApp.Services"
             d:DataContext="{d:DesignInstance Type=viewmodels:AdminPanelViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="500" d:DesignWidth="1000">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal">
            <TextBlock Text="Administrator Panel" FontSize="24" FontWeight="Bold"/>
            <Button Content="Logout" Command="{Binding LogoutCommand}" Margin="50,0,0,0" Width="80" VerticalAlignment="Center"/>
        </StackPanel>

        <TabControl Grid.Row="1" Margin="0,15,0,0">
            <TabItem Header="User Management">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="5,5,5,10">
                        <TextBlock Text="Filter by Username:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                        <TextBox Width="200" Margin="5,0" Text="{Binding UserFilterText, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <GroupBox DockPanel.Dock="Bottom" Header="Add New User" FontWeight="Bold" Margin="5,5,5,5">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Username:" Margin="5" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Margin="5" Text="{Binding NewUsername, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Grid.Column="2" Text="Password:" Margin="5" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="3" Margin="5" Text="{Binding NewPassword, UpdateSourceTrigger=PropertyChanged}"/>
                            <CheckBox Grid.Column="4" Content="Is Admin?" VerticalAlignment="Center" Margin="10,0" IsChecked="{Binding NewUserIsAdmin}"/>
                            <Button Grid.Column="5" Content="Add User" Margin="5" Command="{Binding AddUserCommand}"/>
                        </Grid>
                    </GroupBox>

                    <DataGrid ItemsSource="{Binding UsersView}" 
                              AutoGenerateColumns="False" 
                              IsReadOnly="True" 
                              CanUserSortColumns="True"
                              SelectionMode="Single" Margin="5,0,5,5">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="*"/>
                            <DataGridTextColumn Header="Password" Binding="{Binding Password}" Width="*"/>
                            <DataGridCheckBoxColumn Header="Is Admin" Binding="{Binding IsAdmin}" Width="100"/>
                            <DataGridTemplateColumn Header="Actions" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Delete" Command="{Binding DataContext.DeleteUserCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="IsEnabled" Value="True"/>
                                                    <Style.Triggers>
                                                        <!-- Disable delete for the main 'admin' -->
                                                        <DataTrigger Binding="{Binding Username}" Value="admin">
                                                            <Setter Property="IsEnabled" Value="False"/>
                                                        </DataTrigger>
                                                        <!-- Disable delete for the special '[Deleted User]' -->
                                                        <DataTrigger Binding="{Binding Username}" Value="{x:Static services:UserService.DeletedUserUsername}">
                                                            <Setter Property="IsEnabled" Value="False"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <TabItem Header="Options Management">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <GroupBox Grid.Column="0" Header="Aircraft Types" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ListView Grid.Row="0" ItemsSource="{Binding AppOptions.AircraftTypes}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Width="Auto">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding .}" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="Delete" FontSize="10" Command="{Binding DataContext.DeleteAircraftTypeCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Text="{Binding NewAircraftType, UpdateSourceTrigger=PropertyChanged}" Width="120" Margin="5"/>
                                <Button Content="Add" Command="{Binding AddAircraftTypeCommand}" Margin="5"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Column for managing Tailnumber Types -->
                    <GroupBox Grid.Column="1" Header="Tail Numbers" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ListView Grid.Row="0" ItemsSource="{Binding AppOptions.TailNumbers}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Width="Auto">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding .}" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="Delete" FontSize="10" Command="{Binding DataContext.DeleteTailNumberCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Text="{Binding NewTailNumber, UpdateSourceTrigger=PropertyChanged}" Width="120" Margin="5"/>
                                <Button Content="Add" Command="{Binding AddTailNumberCommand}" Margin="5"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                    <!-- Column for managing Aircraft Sides -->
                    <GroupBox Grid.Column="2" Header="Aircraft Sides" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ListView Grid.Row="0" ItemsSource="{Binding AppOptions.AircraftSides}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Width="Auto">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding .}" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="Delete" FontSize="10" Command="{Binding DataContext.DeleteAircraftSideCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Text="{Binding NewAircraftSide, UpdateSourceTrigger=PropertyChanged}" Width="120" Margin="5"/>
                                <Button Content="Add" Command="{Binding AddAircraftSideCommand}" Margin="5"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Column for managing Reasons -->
                    <GroupBox Grid.Column="3" Header="Reasons" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ListView Grid.Row="0" ItemsSource="{Binding AppOptions.Reasons}">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Width="Auto">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding .}" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="Delete" FontSize="10" Command="{Binding DataContext.DeleteReasonCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                                <TextBox Text="{Binding NewReason, UpdateSourceTrigger=PropertyChanged}" Width="120" Margin="5"/>
                                <Button Content="Add" Command="{Binding AddReasonCommand}" Margin="5"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>